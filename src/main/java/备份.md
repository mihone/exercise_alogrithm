商品检索系统
# 背景
1. 为什么要做？
随着商品，商家不断增长，以及供给结构的变化，
连锁商家的商品管理愈加重要。
2. 原来有没有，有什么问题？
随着业务体量增大，发展迅速，未来业务期望在质量，分析，导购等多个方面为几十个品类的商家赋能，为此，需要一个可以支持多维度复杂条件灵活检索的基建类
检索能力，并可以快速更新迭代。然而当前的商品检索以单个店铺为维度，虽然有降级方案实现跨店铺查询，但性能差，条件少，加条件成本高，无法满足业务发展诉求。

# 挑战
1. 如何设计架构和方案，可以让检索系统的核心，复杂条件的商家维度检索性能高，且后续检索条件开发成本低，更新维护便捷，？
2. 重建一套存储结构，如何保证重建过程中的稳定性和数据的一致性？

# 做法
业界支持复杂条件检索的中间件有ES，和分析型数据库，比如clickhouse，doris，从即时性，使用场景考虑，选用了ES作为检索中间件。
在如何设计检索条件的存储结构上，综合考虑维护便利和有es查询语句复杂嵌套带来的查询性能因素，摈弃了原来索引的横向设计，
将检索条件转化为标签，通过标签的交并补逻辑，以及标签的层级关系，完成对商品的检索。
这样问题转变成了如何设计标签的生产流程，可以支持快速迭代，开发维护成本低。
解决这个的思路有两个方向，配置化和自动化。
第一个 ，配置化，考虑标签本身是个比较通用的概念，设计了两个配置模式，一种是页面提供多种选项，满足条件即可打标，实现形式是根据条件进行数据圈选，
主要面向产品运营。
另一种面向开发，通过aviator表达式，支持复杂的逻辑条件，满足需要上下文信息来进行复杂判断的场景。
第二个，自动化，这涉及了整个系统数据的流转形式和流程。整个商品检索系统有三个模块，圈选模块，标签生产模块，数据读写模块。
标签生产模块会监听其他系统的kafka消息，基于上面说的配置化的标签规则，生产标签。生产的标签存入db，并将产生binlog以消息的形式对外通知。
数据读写模块则监听商品信息和标签信息的变更，写入es。
这里面有两个点，配置变更和外部数据变更如何实现的自动化。
首先，我会监听配置变更的binlog，配置变更会触发数据重新圈选，然后圈选的结果消息形式通知标签生产模块，标签生产模块组装上下文重新计算标签。
然后输出最终的商品标签结果，商品标签结果再通知数据读写模块进行es的更新。
第二个点，外部数据变更，比如说hive 的更新，其他系统产出的数据更新，我都统一使用消息来接收，这样外部的更新我们无须关注，只要外部系统发出变更通知
我会自动重算标签，更新es。

索引里数据 的上游，全部为kafka，换句话说，索引里会有商品信息，标签信息，都是通过kafka流转过来的。
而


这里也考虑到了es写入性能，



# 自问自答
1	供给结构变化是指？
基于Lbs的商家有多个店铺，每个店铺有独立价格库存，随着大品牌的扩张，商家商品中连锁占比非常高，占了大半。

成就
完成了质量信息和检索系统的打通


-----
内容平台怎么衡量产出。
组内成员